<!DOCTYPE html>
<html>
<head>
  <title>S3 Upload With IAM Credentials</title>
  <script src="https://unpkg.com/@aws-sdk/lib-storage"></script>
  <script src="https://unpkg.com/@aws-sdk/client-s3"></script>
</head>
<body>
  <h2>Enter IAM Credentials</h2>
  <label>Access Key ID:</label>
  <input type="text" id="accessKey"><br>
  <label>Secret Access Key:</label>
  <input type="password" id="secretKey"><br><br>

  <h2>Select File to Upload</h2>
  <input type="file" id="fileInput"><br><br>
  <button onclick="uploadFile()">Upload</button>
  <p id="status"></p>

  <script>
    async function uploadFile() {
      const file = document.getElementById('fileInput').files[0];
      const accessKeyId = document.getElementById('accessKey').value;
      const secretAccessKey = document.getElementById('secretKey').value;

      if (!file || !accessKeyId || !secretAccessKey) {
        alert("Please provide credentials and select a file.");
        return;
      }

      const { S3Client } = window.AwsS3Client;
      const { Upload } = window.AwsS3LibStorage;

      const client = new S3Client({
        region: 'us-east-1',
        credentials: {
          accessKeyId,
          secretAccessKey
        }
      });

      const upload = new Upload({
        client,
        params: {
          Bucket: 'your-demo-upload-bucket',
          Key: file.name,
          Body: file,
          ContentType: file.type
        }
      });

      upload.on("httpUploadProgress", (progress) => {
        const percent = Math.round((progress.loaded / progress.total) * 100);
        document.getElementById('status').innerText = `Uploading: ${percent}%`;
      });

      try {
        await upload.done();
        document.getElementById('status').innerText = "✅ Upload complete!";
      } catch (err) {
        console.error(err);
        document.getElementById('status').innerText = "❌ Upload failed: " + err.message;
      }
    }
  </script>
</body>
</html>
