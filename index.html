<!DOCTYPE html>
<html>
<head>
  <title>S3 Upload with IAM Credentials (ES Modules)</title>
  <style>
    body { font-family: Arial; padding: 20px; }
    input, button { padding: 8px; width: 300px; margin: 5px 0; }
    #progressBar { width: 100%; height: 20px; background: #eee; border: 1px solid #ccc; margin-top: 10px; }
    #progressBarFill { height: 100%; width: 0%; background: #4caf50; color: white; text-align: center; line-height: 20px; }
    #status { margin-top: 10px; font-weight: bold; }
  </style>
</head>
<body>
  <h2>Upload File to S3 (via Browser IAM credentials)</h2>
  
  <label>Access Key ID:</label><br><input type="text" id="accessKey"><br>
  <label>Secret Access Key:</label><br><input type="password" id="secretKey"><br>
  <label>Bucket Name:</label><br><input type="text" id="bucketName"><br>
  <label>AWS Region:</label><br><input type="text" id="region" placeholder="e.g. ap-south-1"><br>
  <label>Select File:</label><br><input type="file" id="fileInput"><br><br>
  <button onclick="uploadFile()">Upload</button>
  
  <div id="progressBar"><div id="progressBarFill">0%</div></div>
  <p id="status"></p>
  
  <script type="module">
    import { S3Client } from 'https://cdn.jsdelivr.net/npm/@aws-sdk/client-s3@3.470.0/+esm';
    import { Upload } from 'https://cdn.jsdelivr.net/npm/@aws-sdk/lib-storage@3.470.0/+esm';
    
    window.uploadFile = async function() {
      const ak = document.getElementById('accessKey').value.trim();
      const sk = document.getElementById('secretKey').value.trim();
      const bucket = document.getElementById('bucketName').value.trim();
      const region = document.getElementById('region').value.trim();
      const file = document.getElementById('fileInput').files[0];
      const statusEl = document.getElementById('status');
      const progressFill = document.getElementById('progressBarFill');
      statusEl.innerText = ''; progressFill.style.width = '0%'; progressFill.innerText = '0%';
      
      if (!ak || !sk || !bucket || !region || !file) {
        return alert("Please fill all fields and select a file.");
      }
      
      try {
        const client = new S3Client({ region, credentials: { accessKeyId: ak, secretAccessKey: sk } });
        const uploader = new Upload({ client, params: { Bucket: bucket, Key: file.name, Body: file, ContentType: file.type } });
        
        uploader.on("httpUploadProgress", (p) => {
          const pct = Math.round((p.loaded / p.total) * 100);
          progressFill.style.width = pct + '%';
          progressFill.innerText = pct + '%';
          statusEl.innerText = `Uploading: ${pct}%`;
        });
        
        await uploader.done();
        progressFill.style.width = '100%';
        progressFill.innerText = '100%';
        statusEl.innerText = '✅ Upload successful!';
      } catch (e) {
        console.error("Upload error:", e);
        statusEl.innerText = '❌ Upload failed: ' + e.message;
      }
    };
  </script>
</body>
</html>
