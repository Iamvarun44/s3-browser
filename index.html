<!DOCTYPE html>
<html>
<head>
  <title>S3 Direct Upload with IAM Credentials</title>
  <script src="https://unpkg.com/@aws-sdk/client-s3@3.535.0"></script>
  <script src="https://unpkg.com/@aws-sdk/lib-storage@3.535.0"></script>
  <style>
    body { font-family: Arial; padding: 20px; }
    input, button { margin: 5px 0; padding: 8px; width: 300px; }
    #progressBar {
      width: 100%;
      height: 20px;
      background-color: #eee;
      border: 1px solid #ccc;
      margin-top: 10px;
    }
    #progressBarFill {
      height: 100%;
      width: 0%;
      background-color: #4caf50;
      text-align: center;
      color: white;
      line-height: 20px;
    }
    #status { margin-top: 10px; font-weight: bold; }
  </style>
</head>
<body>
  <h2>Upload File to S3 (Browser-based)</h2>

  <label>AWS Access Key ID</label><br>
  <input type="text" id="accessKey" placeholder="Enter Access Key ID"><br>

  <label>AWS Secret Access Key</label><br>
  <input type="password" id="secretKey" placeholder="Enter Secret Access Key"><br>

  <label>S3 Bucket Name</label><br>
  <input type="text" id="bucketName" placeholder="e.g., my-upload-bucket"><br>

  <label>AWS Region</label><br>
  <input type="text" id="region" placeholder="e.g., us-east-1"><br>

  <label>Select File</label><br>
  <input type="file" id="fileInput"><br>

  <button onclick="uploadFile()">Upload to S3</button>

  <div id="progressBar">
    <div id="progressBarFill">0%</div>
  </div>

  <p id="status"></p>

  <script>
    async function uploadFile() {
      const accessKeyId = document.getElementById('accessKey').value;
      const secretAccessKey = document.getElementById('secretKey').value;
      const bucket = document.getElementById('bucketName').value;
      const region = document.getElementById('region').value;
      const file = document.getElementById('fileInput').files[0];

      const statusText = document.getElementById('status');
      const progressFill = document.getElementById('progressBarFill');
      progressFill.style.width = '0%';
      progressFill.innerText = '0%';
      statusText.innerText = '';

      if (!accessKeyId || !secretAccessKey || !bucket || !region || !file) {
        alert('Please fill in all fields and select a file.');
        return;
      }

      const { S3Client } = window.AwsS3Client;
      const { Upload } = window.AwsS3LibStorage;

      const s3Client = new S3Client({
        region,
        credentials: {
          accessKeyId,
          secretAccessKey
        }
      });

      const upload = new Upload({
        client: s3Client,
        params: {
          Bucket: bucket,
          Key: file.name,
          Body: file,
          ContentType: file.type
        }
      });

      upload.on("httpUploadProgress", (progress) => {
        const percent = Math.round((progress.loaded / progress.total) * 100);
        progressFill.style.width = percent + '%';
        progressFill.innerText = percent + '%';
        statusText.innerText = `Uploading: ${percent}%`;
      });

      try {
        await upload.done();
        progressFill.style.width = '100%';
        progressFill.innerText = '100%';
        statusText.innerText = '✅ Upload successful!';
      } catch (err) {
        console.error(err);
        statusText.innerText = '❌ Upload failed: ' + err.message;
        progressFill.style.width = '0%';
        progressFill.innerText = '0%';
      }
    }
  </script>
</body>
</html>
