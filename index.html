<!DOCTYPE html>
<html>
<head>
  <title>Upload File to S3 (with IAM creds)</title>
  <script src="https://cdn.jsdelivr.net/npm/@aws-sdk/client-s3-browser@3.470.0/dist/aws-sdk-client-s3-browser.umd.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@aws-sdk/lib-storage@3.470.0/dist/aws-sdk-lib-storage.umd.min.js"></script>
  <style>
    body { font-family: Arial; padding: 20px; }
    input, button { padding: 8px; width: 300px; margin: 5px 0; }
    #progressBar {
      width: 100%; height: 20px; background-color: #eee;
      border: 1px solid #ccc; margin-top: 10px;
    }
    #progressBarFill {
      height: 100%; width: 0%;
      background-color: #4caf50; color: white;
      text-align: center; line-height: 20px;
    }
    #status { margin-top: 10px; font-weight: bold; }
  </style>
</head>
<body>
  <h2>S3 File Upload (Browser + IAM credentials)</h2>

  <label>AWS Access Key ID</label><br>
  <input type="text" id="accessKey" placeholder="Enter Access Key ID"><br>

  <label>AWS Secret Access Key</label><br>
  <input type="password" id="secretKey" placeholder="Enter Secret Access Key"><br>

  <label>S3 Bucket Name</label><br>
  <input type="text" id="bucketName" placeholder="e.g., my-upload-bucket"><br>

  <label>AWS Region</label><br>
  <input type="text" id="region" placeholder="e.g., us-east-1"><br>

  <label>Select File</label><br>
  <input type="file" id="fileInput"><br><br>

  <button onclick="uploadFile()">Upload to S3</button>

  <div id="progressBar">
    <div id="progressBarFill">0%</div>
  </div>

  <p id="status"></p>

  <script>
    async function uploadFile() {
      const accessKeyId = document.getElementById('accessKey').value.trim();
      const secretAccessKey = document.getElementById('secretKey').value.trim();
      const bucket = document.getElementById('bucketName').value.trim();
      const region = document.getElementById('region').value.trim();
      const file = document.getElementById('fileInput').files[0];

      const status = document.getElementById('status');
      const progressFill = document.getElementById('progressBarFill');
      progressFill.style.width = '0%';
      progressFill.innerText = '0%';
      status.innerText = '';

      if (!accessKeyId || !secretAccessKey || !bucket || !region || !file) {
        alert("Please fill in all fields and select a file.");
        return;
      }

      const client = new window.AwsClientS3Browser.S3Client({
        region: region,
        credentials: {
          accessKeyId: accessKeyId,
          secretAccessKey: secretAccessKey
        }
      });

      const upload = new window.AwsLibStorage.Upload({
        client: client,
        params: {
          Bucket: bucket,
          Key: file.name,
          Body: file,
          ContentType: file.type
        }
      });

      upload.on("httpUploadProgress", (progress) => {
        const percent = Math.round((progress.loaded / progress.total) * 100);
        progressFill.style.width = percent + '%';
        progressFill.innerText = percent + '%';
        status.innerText = `Uploading: ${percent}%`;
      });

      try {
        await upload.done();
        progressFill.style.width = '100%';
        progressFill.innerText = '100%';
        status.innerText = '✅ Upload successful!';
      } catch (error) {
        console.error("Upload failed:", error);
        status.innerText = '❌ Upload failed: ' + error.message;
      }
    }
  </script>
</body>
</html>
